{"version":3,"names":["_default","MONGODB_URI","cov_1b254wsx3j","s","process","env","b","Error","cached","global","mongoose","conn","promise","dbConnect","f","console","log","opts","bufferCommands","replace","_mongoose","default","connect","then","e","error"],"sources":["C:\\Users\\janne\\Documents\\workspace\\my-board-app\\lib\\mongodb.ts"],"sourcesContent":["import mongoose from 'mongoose';\n\nconst MONGODB_URI = process.env.MONGODB_URI!;\n\nif (!MONGODB_URI) {\n  throw new Error('MONGODB_URIが環境変数に設定されていません');\n}\n\ninterface MongooseCache {\n  conn: typeof mongoose | null;\n  promise: Promise<typeof mongoose> | null;\n}\n\ndeclare global {\n  var mongoose: MongooseCache | undefined;\n}\n\nlet cached = global.mongoose;\n\nif (!cached) {\n  cached = global.mongoose = { conn: null, promise: null };\n}\n\nasync function dbConnect() {\n  if (cached!.conn) {\n    console.log('既存のMongoDB接続を使用');\n    return cached!.conn;\n  }\n\n  if (!cached!.promise) {\n    const opts = {\n      bufferCommands: false,\n    };\n\n    console.log('MongoDBに接続中...');\n    console.log('接続先:', MONGODB_URI.replace(/\\/\\/.*@/, '//<credentials>@'));\n    \n    cached!.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\n      console.log('MongoDB接続成功！');\n      return mongoose;\n    });\n  }\n\n  try {\n    cached!.conn = await cached!.promise;\n  } catch (e) {\n    console.error('MongoDB接続エラー:', e);\n    cached!.promise = null;\n    throw e;\n  }\n\n  return cached!.conn;\n}\n\nexport default dbConnect;"],"mappings":"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","ignoreList":[]}